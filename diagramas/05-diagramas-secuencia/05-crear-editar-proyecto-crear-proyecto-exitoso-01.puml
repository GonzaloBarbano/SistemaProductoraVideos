@startuml 
title Diagrama de Secuencia - Crear Proyecto (Exitoso)

actor Cliente
participant "PantallaProyectos : UI" as PantallaProyectos
participant "ControladorProyecto : Controlador" as ControladorProyecto
participant "ServicioProyecto : Servicio" as ServicioProyecto
participant "RepositorioProyecto : Repositorio" as RepositorioProyecto
participant "ServicioNotificaciones : Servicio" as ServicioNotificaciones

' ==== Inicio del escenario ====
Cliente -> PantallaProyectos : seleccionar opción "Nuevo Proyecto"
activate PantallaProyectos

note right of PantallaProyectos
El cliente accede a la opción "Nuevo Proyecto"
desde el menú principal.
end note

PantallaProyectos -> ControladorProyecto : mostrar formulario
activate ControladorProyecto
ControladorProyecto -> PantallaProyectos : solicitar datos del proyecto
deactivate ControladorProyecto

' ==== Cliente completa el formulario ====
Cliente -> PantallaProyectos : ingresar datos del proyecto

note right of PantallaProyectos
El cliente completa los datos y presiona "Guardar".
end note

PantallaProyectos -> ControladorProyecto : enviar Proyecto
activate ControladorProyecto

ControladorProyecto -> ServicioProyecto : validar(Proyecto)
activate ServicioProyecto

' ==== Validaciones internas sobre Proyecto ====
ServicioProyecto -> ServicioProyecto : validar campos obligatorios(Proyecto)
ServicioProyecto -> ServicioProyecto : validar fechas(Proyecto)
ServicioProyecto -> ServicioProyecto : verificar duplicado de nombre(Proyecto)

' ==== Bloque corregido ====
alt Validación con errores
    ServicioProyecto -> ControladorProyecto : devolver errores
    ControladorProyecto -> PantallaProyectos : mostrar errores
    deactivate ControladorProyecto
    deactivate PantallaProyectos

else Validación exitosa
    ServicioProyecto -> RepositorioProyecto : guardar(Proyecto)
    activate RepositorioProyecto
    note right of RepositorioProyecto
Se persiste el objeto Proyecto completo.
end note
    RepositorioProyecto -> ServicioProyecto : devolver Proyecto
    deactivate RepositorioProyecto

    ServicioProyecto -> RepositorioProyecto : registrar auditoría(Proyecto)
    activate RepositorioProyecto
    RepositorioProyecto -> ServicioProyecto : auditoría confirmada
    deactivate RepositorioProyecto

    note right of ServicioProyecto
Se registra la auditoría asociada al objeto Proyecto.
end note

    ServicioProyecto -> ServicioNotificaciones : enviarNotificación(Proyecto)
    activate ServicioNotificaciones

    note right of ServicioNotificaciones
Se envía una notificación utilizando datos del Proyecto.
end note

    ServicioNotificaciones -> ServicioProyecto : confirmación envío
    deactivate ServicioNotificaciones

    ServicioProyecto -> ControladorProyecto : confirmar creación(Proyecto)
    deactivate ServicioProyecto

    ControladorProyecto -> PantallaProyectos : mostrar detalle(Proyecto)
    note left of PantallaProyectos
El sistema muestra el detalle final del Proyecto creado.
end note

    deactivate ControladorProyecto
    deactivate PantallaProyectos
end

@enduml
