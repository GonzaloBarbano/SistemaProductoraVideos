@startuml
title Diagrama de Actividades - Crear/Editar Proyecto (UC1)

|Coordinador/Productor|
start
:Seleccionar "Nuevo Proyecto" o "Editar Proyecto";
:Completar formulario del Proyecto;
:Enviar Proyecto al sistema;

|Sistema de Gestión|
repeat
    :Recibir Proyecto;
    :Validar campos obligatorios del Proyecto;
    note right
    Se valida el objeto Proyecto:
    nombre, fechas, descripción, responsable.
    end note

    if (¿Campos completos?) then (Sí)
        break
    else (No)
        :Mostrar error "Campos obligatorios faltantes";
        :Solicitar reenvío del Proyecto corregido;
    endif
repeat while (Campos incompletos)

repeat
    :Validar fechas del Proyecto;
    note right
    Se verifica la consistencia de las fechas
    dentro del objeto Proyecto.
    end note

    if (¿Fechas válidas?) then (Sí)
        break
    else (No)
        :Mostrar error "Fechas inválidas";
        :Solicitar Proyecto corregido;
    endif
repeat while (Fechas inválidas)

repeat
    :Verificar nombre duplicado del Proyecto;
    note right
    Se consulta si existe otro Proyecto
    con el mismo nombre.
    end note

    if (¿Nombre duplicado?) then (No)
        break
    else (Sí)
        :Mostrar error "Proyecto duplicado";
        :Solicitar corrección del Proyecto;
    endif
repeat while (Nombre duplicado)

fork
    :Guardar Proyecto en base de datos;
fork again
    :Registrar auditoría del Proyecto;
end fork

:Generar evento de notificación(Proyecto);

|Servicio de Notificaciones|
:Componer mensaje basado en Proyecto;
:Enviar notificación a destinatarios;
:Registrar resultado del envío;

|Sistema de Gestión|
:Registrar envío en historial del Proyecto;
:Mostrar confirmación;

|Coordinador/Productor|
:Revisar confirmación;
stop
@enduml
