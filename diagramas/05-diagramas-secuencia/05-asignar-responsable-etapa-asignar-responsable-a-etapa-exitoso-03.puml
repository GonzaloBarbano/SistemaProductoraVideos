@startuml
title Diagrama de Secuencia - Asignar Responsable a Etapa (Exitoso)

actor Coordinador
participant "PantallaProyecto : detalleProyecto" as PantallaProyecto
participant "Sistema : GestorEtapa" as Sistema
participant "SelectorUsuario : selector" as SelectorUsuario
participant ServicioNotificaciones

'--- Inicio del flujo ---
Coordinador -> PantallaProyecto : abrir detalle del proyecto
activate PantallaProyecto

PantallaProyecto -> Sistema : obtenerEtapas(Proyecto)
activate Sistema
Sistema -> PantallaProyecto : enviarLista(Etapa[])
deactivate Sistema

Coordinador -> PantallaProyecto : seleccionarEtapa(Etapa)
PantallaProyecto -> Sistema : obtenerDatos(Etapa)
activate Sistema
Sistema -> PantallaProyecto : devolverDatos(Etapa)
deactivate Sistema

Coordinador -> PantallaProyecto : seleccionar "Asignar Responsable"
PantallaProyecto -> SelectorUsuario : mostrarSelectorUsuarios()
activate SelectorUsuario

Coordinador -> SelectorUsuario : elegirResponsable(Usuario)
SelectorUsuario -> Sistema : validarYActualizarResponsable(Etapa, Usuario)
activate Sistema

Sistema -> Sistema : registrarCambio(Etapa, Usuario)
Sistema -> ServicioNotificaciones : enviarNotificación(Usuario, Etapa)
activate ServicioNotificaciones
ServicioNotificaciones -> Sistema : confirmarEnvío()
deactivate ServicioNotificaciones

Sistema -> PantallaProyecto : mostrarConfirmación(Etapa, Usuario)

PantallaProyecto -> Coordinador : mostrarMensajeConfirmación()

deactivate Sistema
deactivate PantallaProyecto
deactivate SelectorUsuario
destroy SelectorUsuario

@enduml
