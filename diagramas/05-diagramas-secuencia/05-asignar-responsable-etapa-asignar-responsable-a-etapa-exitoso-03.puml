@startuml
title Diagrama de Secuencia - Asignar Responsable a Etapa (Exitoso)

actor Coordinador
participant "PantallaProyecto:detalleProyecto" as PantallaProyecto
participant "Sistema:GestorEtapa" as Sistema
participant "SelectorUsuario:selector" as SelectorUsuario
participant ServicioNotificaciones

'--- Inicio del flujo ---
Coordinador -> PantallaProyecto: abrirDetalleProyecto(idProyecto)
activate PantallaProyecto

PantallaProyecto -> Sistema: obtenerEtapasProyecto(idProyecto)
activate Sistema
Sistema --> PantallaProyecto: mostrarListaEtapas(listaEtapas)
deactivate Sistema

Coordinador -> PantallaProyecto: seleccionarEtapa(idEtapa)
PantallaProyecto -> Sistema: obtenerDatosEtapa(idEtapa)
activate Sistema
Sistema --> PantallaProyecto: mostrarDatosEtapa(datosEtapa)
deactivate Sistema

Coordinador -> PantallaProyecto: seleccionarAsignarResponsable()
PantallaProyecto -> SelectorUsuario: desplegarSelectorUsuarios()
activate SelectorUsuario

Coordinador -> SelectorUsuario: elegirResponsable(idUsuario)
SelectorUsuario -> Sistema: validarYActualizarResponsable(idEtapa, idUsuario)
activate Sistema
Sistema -> Sistema: registrarCambioHistorial(idEtapa, idUsuario, fechaHora)
Sistema -> ServicioNotificaciones: enviarNotificacion(idUsuario, mensajeAsignacion)
activate ServicioNotificaciones
ServicioNotificaciones --> Sistema: notificacionEnviada()
deactivate ServicioNotificaciones

Sistema --> PantallaProyecto: mostrarConfirmacionAsignacion("Responsable asignado con éxito")

' Pantalla muestra la confirmación al actor/coordinador
PantallaProyecto --> Coordinador: mostrarConfirmacionEnPantalla(mensajeConfirmacion)

deactivate Sistema
deactivate PantallaProyecto

' Finalización del selector temporal
deactivate SelectorUsuario
destroy SelectorUsuario

@enduml
