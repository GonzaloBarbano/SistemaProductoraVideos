@startuml
title Diagrama de Secuencia - Enviar Notificaciones Automáticas (Exitoso)

actor ResponsableEtapa
participant "Sistema : GestorNotificaciones" as Sistema
participant "GestorCanales : canalEnvio" as GestorCanales
participant "ServicioNotificaciones : notificador" as ServicioNotificaciones
participant "Usuario : destinatario" as Destinatario
participant "SistemaIntegracion : registroExterno" as SistemaIntegracion

'--- Inicio del flujo ---
ResponsableEtapa -> Sistema : generar evento notificable
activate Sistema

Sistema -> Sistema : identificar destinatarios

'--- Issue 62: interacción explícita para determinar el canal ---
Sistema -> GestorCanales : solicitar canal de envío
activate GestorCanales
GestorCanales -> Sistema : devolver canal seleccionado
deactivate GestorCanales

Sistema -> Sistema : componer mensajes para destinatarios

Sistema -> ServicioNotificaciones : enviar notificaciones
activate ServicioNotificaciones

ServicioNotificaciones -> Destinatario : enviar mensaje por canal
activate Destinatario
Destinatario -> ServicioNotificaciones : confirmar recepción
deactivate Destinatario

ServicioNotificaciones -> Sistema : devolver resultado de envío

Sistema -> SistemaIntegracion : registrar resultado del envío
activate SistemaIntegracion
SistemaIntegracion -> Sistema : confirmar registro externo
deactivate SistemaIntegracion

Sistema -> Sistema : registrar historial de notificaciones
Sistema -> ResponsableEtapa : mostrar confirmación de envío

deactivate ServicioNotificaciones
deactivate Sistema

destroy ServicioNotificaciones
@enduml
