@startuml
title Diagrama de Actividades - Enviar Notificaciones Automáticas 
|Sistema de Gestión|
start
:Detectar evento activador;
:Crear contexto de notificación;
:Solicitar identificación de destinatarios;

|Coordinador/Productor|
:Agregar destinatarios manuales (opcional);

|Responsable de Etapa|
:Confirmar destinatarios sugeridos (opcional);

|Sistema de Gestión|
:Compilar lista final de destinatarios;
:Consultar preferencias de comunicación;

if (Hay destinatarios?) then (no)
  :Abortar notificación y registrar motivo;
  end
else (sí)
  :Determinar canal preferido (Email, WhatsApp, Push);

  partition "Canal: Email / WhatsApp / Push" {
    :Componer mensaje (plantilla + datos);
    fork
      :Intentar envío por canal;
    fork again
      :Registrar intento en historial;
    end fork

    if (Envío exitoso?) then (sí)
      :Marcar envío como exitoso;
    else (no)
      :Reintentar según política;
      if (Superó reintentos?) then (sí)
        :Marcar envío como fallido;
        :Notificar Admin;
      else (no)
        :Reintentar envío;
      endif
    endif
  }

  |Servicio de Notificaciones|
  :Consolidar resultados de envíos;
  :Enviar resumen al Sistema de Gestión;

  |Sistema de Gestión|
  :Registrar en historial;
  :Si hay fallas críticas -> generar alerta;
endif

|Sistema de Gestión|
stop
@enduml
